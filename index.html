<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>×¤×ª×™×—×ª ×¡×¤×§ ×“×™×’×™×˜×œ×™ | ×¢×™×¨×™×™×ª ×¨××ª ×’×Ÿ</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

<style>
  :root {
    --primary: #1a4f8a;
    --primary-light: #2563b0;
    --accent: #e8a020;
    --success: #16a34a;
    --danger: #dc2626;
    --bg: #f4f6fb;
    --card: #ffffff;
    --border: #d1d9e6;
    --text: #1e293b;
    --text-light: #64748b;
    --step-done: #16a34a;
    --shadow: 0 4px 24px rgba(26,79,138,0.10);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Heebo', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    direction: rtl;
  }

  /* Header */
  .header {
    background: linear-gradient(135deg, var(--primary) 0%, #0d3060 100%);
    color: white;
    padding: 18px 32px;
    display: flex;
    align-items: center;
    gap: 18px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.18);
    position: sticky;
    top: 0;
    z-index: 100;
  }
  .header-logo {
    width: 52px;
    height: 52px;
    background: white;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    font-weight: 800;
    color: var(--primary);
    letter-spacing: -1px;
    flex-shrink: 0;
  }
  .header-text h1 { font-size: 1.25rem; font-weight: 700; }
  .header-text p { font-size: 0.82rem; opacity: 0.75; }

  /* Progress */
  .progress-wrap {
    background: white;
    border-bottom: 2px solid var(--border);
    padding: 0 32px;
  }
  .progress-steps {
    display: flex;
    max-width: 860px;
    margin: 0 auto;
    position: relative;
  }
  .progress-steps::before {
    content: '';
    position: absolute;
    top: 30px;
    right: 10%;
    left: 10%;
    height: 2px;
    background: var(--border);
    z-index: 0;
  }
  .step-item {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 18px 8px 14px;
    cursor: pointer;
    position: relative;
    z-index: 1;
  }
  .step-circle {
    width: 36px; height: 36px;
    border-radius: 50%;
    background: var(--border);
    color: var(--text-light);
    display: flex; align-items: center; justify-content: center;
    font-weight: 700; font-size: 0.9rem;
    transition: all 0.3s;
    border: 3px solid white;
    box-shadow: 0 0 0 2px var(--border);
  }
  .step-item.active .step-circle {
    background: var(--primary);
    color: white;
    box-shadow: 0 0 0 2px var(--primary);
  }
  .step-item.done .step-circle {
    background: var(--step-done);
    color: white;
    box-shadow: 0 0 0 2px var(--step-done);
  }
  .step-label {
    font-size: 0.72rem;
    color: var(--text-light);
    margin-top: 6px;
    text-align: center;
    font-weight: 500;
  }
  .step-item.active .step-label { color: var(--primary); font-weight: 700; }
  .step-item.done .step-label { color: var(--step-done); }

  /* Content */
  .content {
    max-width: 860px;
    margin: 36px auto;
    padding: 0 20px 60px;
  }

  .panel {
    display: none;
    animation: fadeIn 0.3s ease;
  }
  .panel.active { display: block; }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(12px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .card {
    background: var(--card);
    border-radius: 18px;
    box-shadow: var(--shadow);
    padding: 36px 40px;
    margin-bottom: 20px;
    border: 1px solid var(--border);
  }

  .card-title {
    font-size: 1.15rem;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 6px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .card-title::before {
    content: '';
    display: block;
    width: 4px;
    height: 22px;
    background: var(--accent);
    border-radius: 3px;
  }
  .card-subtitle {
    font-size: 0.85rem;
    color: var(--text-light);
    margin-bottom: 26px;
    padding-right: 14px;
  }

  /* Intro panel */
  .intro-box {
    background: linear-gradient(135deg, #eef4ff 0%, #f8faff 100%);
    border: 1.5px solid #c3d9f5;
    border-radius: 14px;
    padding: 28px 32px;
    margin-bottom: 28px;
  }
  .intro-box h2 {
    font-size: 1.05rem;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 16px;
  }
  .intro-box ol {
    padding-right: 22px;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  .intro-box li {
    font-size: 0.9rem;
    color: var(--text);
    line-height: 1.6;
  }
  .intro-box li strong { color: var(--primary); }

  .warning-box {
    background: #fff8ec;
    border: 1.5px solid #f5c97a;
    border-radius: 12px;
    padding: 16px 20px;
    font-size: 0.85rem;
    color: #92600a;
    line-height: 1.6;
  }
  .warning-box strong { color: #7a4e05; }

  /* Form */
  .form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
  }
  .form-grid .full { grid-column: 1 / -1; }

  .field {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  label {
    font-size: 0.82rem;
    font-weight: 600;
    color: var(--text);
  }
  label .req { color: var(--danger); margin-right: 2px; }

  input[type="text"],
  input[type="email"],
  input[type="tel"],
  input[type="date"],
  input[type="number"],
  select,
  textarea {
    width: 100%;
    padding: 11px 14px;
    border: 1.5px solid var(--border);
    border-radius: 10px;
    font-family: 'Heebo', sans-serif;
    font-size: 0.9rem;
    color: var(--text);
    background: #fafbfd;
    transition: border-color 0.2s, box-shadow 0.2s;
    outline: none;
  }
  input:focus, select:focus, textarea:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(26,79,138,0.12);
    background: white;
  }
  input.error, select.error { border-color: var(--danger); }
  .error-msg {
    font-size: 0.75rem;
    color: var(--danger);
    display: none;
  }
  .field.has-error .error-msg { display: block; }
  .field.has-error input,
  .field.has-error select { border-color: var(--danger); }

  select { cursor: pointer; }

  /* Radio group */
  .radio-group {
    display: flex;
    gap: 14px;
    margin-top: 2px;
  }
  .radio-btn {
    display: flex;
    align-items: center;
    gap: 7px;
    cursor: pointer;
    font-size: 0.88rem;
    padding: 9px 18px;
    border: 1.5px solid var(--border);
    border-radius: 8px;
    transition: all 0.2s;
    user-select: none;
  }
  .radio-btn input { display: none; }
  .radio-btn.selected {
    border-color: var(--primary);
    background: #eef4ff;
    color: var(--primary);
    font-weight: 600;
  }
  .radio-dot {
    width: 14px; height: 14px;
    border-radius: 50%;
    border: 2px solid var(--border);
    transition: all 0.2s;
    flex-shrink: 0;
  }
  .radio-btn.selected .radio-dot {
    border-color: var(--primary);
    background: var(--primary);
    box-shadow: inset 0 0 0 3px white;
  }

  /* File upload */
  .file-upload {
    border: 2px dashed var(--border);
    border-radius: 12px;
    padding: 22px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
    background: #fafbfd;
    position: relative;
  }
  .file-upload:hover { border-color: var(--primary); background: #eef4ff; }
  .file-upload.has-file { border-color: var(--success); background: #f0fdf4; }
  .file-upload input { position: absolute; inset: 0; opacity: 0; cursor: pointer; }
  .file-upload-icon { font-size: 2rem; margin-bottom: 6px; }
  .file-upload-text { font-size: 0.82rem; color: var(--text-light); }
  .file-upload-text strong { color: var(--primary); }
  .file-name { font-size: 0.8rem; color: var(--success); font-weight: 600; margin-top: 4px; }

  /* Signature */
  .signature-wrap {
    border: 1.5px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
    background: white;
  }
  .signature-toolbar {
    background: #f4f6fb;
    padding: 8px 14px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid var(--border);
    font-size: 0.8rem;
    color: var(--text-light);
  }
  .clear-btn {
    background: none;
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 4px 12px;
    cursor: pointer;
    font-size: 0.78rem;
    font-family: 'Heebo', sans-serif;
    color: var(--text-light);
    transition: all 0.2s;
  }
  .clear-btn:hover { border-color: var(--danger); color: var(--danger); }
  canvas#sigCanvas {
    display: block;
    width: 100%;
    height: 160px;
    cursor: crosshair;
    touch-action: none;
  }

  /* Section divider */
  .section-divider {
    display: flex;
    align-items: center;
    gap: 12px;
    margin: 28px 0 20px;
    color: var(--text-light);
    font-size: 0.8rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  .section-divider::before, .section-divider::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--border);
  }

  /* Checkbox agree */
  .agree-wrap {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 18px 20px;
    background: #f8faff;
    border: 1.5px solid #c3d9f5;
    border-radius: 12px;
  }
  .agree-wrap input[type="checkbox"] {
    width: 20px; height: 20px;
    margin-top: 2px;
    cursor: pointer;
    accent-color: var(--primary);
    flex-shrink: 0;
  }
  .agree-wrap label {
    font-size: 0.83rem;
    color: var(--text);
    line-height: 1.6;
    font-weight: 400;
    cursor: pointer;
  }

  /* Navigation buttons */
  .nav-buttons {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 30px;
    gap: 16px;
  }
  .btn {
    padding: 13px 32px;
    border-radius: 10px;
    font-family: 'Heebo', sans-serif;
    font-size: 0.95rem;
    font-weight: 600;
    cursor: pointer;
    border: none;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .btn-primary {
    background: var(--primary);
    color: white;
    box-shadow: 0 4px 16px rgba(26,79,138,0.25);
  }
  .btn-primary:hover { background: var(--primary-light); transform: translateY(-1px); }
  .btn-secondary {
    background: white;
    color: var(--primary);
    border: 1.5px solid var(--border);
  }
  .btn-secondary:hover { border-color: var(--primary); background: #eef4ff; }
  .btn-success {
    background: var(--success);
    color: white;
    box-shadow: 0 4px 16px rgba(22,163,74,0.25);
  }
  .btn-success:hover { background: #15803d; }

  /* Success screen */
  .success-screen {
    text-align: center;
    padding: 60px 40px;
  }
  .success-icon {
    width: 90px; height: 90px;
    background: linear-gradient(135deg, var(--success), #22c55e);
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 42px;
    margin: 0 auto 24px;
    box-shadow: 0 8px 32px rgba(22,163,74,0.3);
    animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  }
  @keyframes popIn {
    from { transform: scale(0); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
  }
  .success-screen h2 { font-size: 1.6rem; font-weight: 800; color: var(--primary); margin-bottom: 12px; }
  .success-screen p { color: var(--text-light); font-size: 0.95rem; line-height: 1.7; margin-bottom: 8px; }
  .ref-number {
    display: inline-block;
    background: #eef4ff;
    border: 1.5px solid #c3d9f5;
    border-radius: 10px;
    padding: 10px 24px;
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--primary);
    margin: 16px 0;
    letter-spacing: 1px;
  }

  /* Responsive */
  @media (max-width: 600px) {
    .form-grid { grid-template-columns: 1fr; }
    .card { padding: 24px 18px; }
    .header { padding: 14px 18px; }
    .content { padding: 0 12px 60px; }
    .nav-buttons { flex-direction: column-reverse; }
    .btn { width: 100%; justify-content: center; }
  }

  /* Loading overlay */
  .loading-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.45);
    z-index: 999;
    align-items: center;
    justify-content: center;
  }
  .loading-overlay.active { display: flex; }
  .spinner {
    width: 52px; height: 52px;
    border: 4px solid rgba(255,255,255,0.3);
    border-top-color: white;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
</style>
</head>
<body>

<!-- Header -->
<div class="header">
  <div class="header-logo">×¨×’</div>
  <div class="header-text">
    <h1>×¤×ª×™×—×ª ×¡×¤×§ ×“×™×’×™×˜×œ×™</h1>
    <p>×¢×™×¨×™×™×ª ×¨××ª ×’×Ÿ â€¢ ××™× ×”×œ ×”×›×¡×¤×™×</p>
  </div>
</div>

<!-- Progress -->
<div class="progress-wrap">
  <div class="progress-steps">
    <div class="step-item active" id="step-tab-1" onclick="goToStep(1)">
      <div class="step-circle">1</div>
      <div class="step-label">×”×§×“××”</div>
    </div>
    <div class="step-item" id="step-tab-2">
      <div class="step-circle">2</div>
      <div class="step-label">×¤×¨×˜×™ ×¡×¤×§</div>
    </div>
    <div class="step-item" id="step-tab-3">
      <div class="step-circle">3</div>
      <div class="step-label">××¡××›×™×</div>
    </div>
    <div class="step-item" id="step-tab-4">
      <div class="step-circle">4</div>
      <div class="step-label">××™×©×•×¨ ×•×—×ª×™××”</div>
    </div>
  </div>
</div>

<!-- Content -->
<div class="content">

  <!-- STEP 1: Intro -->
  <div class="panel active" id="panel-1">
    <div class="card">
      <div class="card-title">×‘×¨×•×›×™× ×”×‘××™× ×œ×˜×•×¤×¡ ×¤×ª×™×—×ª ×¡×¤×§</div>
      <div class="card-subtitle">××“×•×Ÿ/×’×‘×¨×ª × ×›×‘×“/×”, ×× × ×§×¨××• ×‘×¢×™×•×Ÿ ×œ×¤× ×™ ×”××™×œ×•×™</div>

      <div class="intro-box">
        <h2>âš ï¸ ×”× ×—×™×•×ª ×—×©×•×‘×•×ª</h2>
        <ol>
          <li>×”×–×× ×” ×¢×“ ×œ×¡×š ×©×œ <strong>10,000 â‚ª</strong> ××—×™×™×‘×ª ×œ×¤×—×•×ª ×—×ª×™××” ××—×ª ×©×œ ×”×’×–×‘×¨×•×ª.</li>
          <li>×”×–×× ×” ××¢×œ ×¡×š ×©×œ <strong>10,000 â‚ª</strong> ××—×™×™×‘×ª ×©×ª×™ ×—×ª×™××•×ª â€” ×”××—×ª ×©×œ ×”×’×–×‘×¨×•×ª ×•×”×©× ×™×™×” ×©×œ ×”×”× ×”×œ×”.</li>
          <li>×›×œ ×¢×‘×•×“×” ×©×ª×‘×•×¦×¢ <strong>×œ×œ× ×§×‘×œ×ª ×”×–×× ×” ×—×ª×•××”</strong> ×‘×”×ª×× ×œ× ×•×”×œ ×•××¨××© â€” <strong>×œ× ×ª×©×•×œ×</strong> ×¢×œ ×™×“×™ ×”×¢×™×¨×™×™×”, ×•×”××—×¨×™×•×ª ×ª×—×•×œ ×¢×œ×™×›× ×•×¢×œ ×”×’×•×¨× ×©×”×–××™×Ÿ ××›× ××ª ×”×¢×‘×•×“×”.</li>
        </ol>
      </div>

      <div class="warning-box">
        <strong>ğŸ“‹ ××¡××›×™× × ×“×¨×©×™× ×œ×”×›× ×” ××¨××©:</strong><br><br>
        â€¢ ××™×©×•×¨ × ×™×”×•×œ ×¡×¤×¨×™× (×‘×ª×•×§×£)<br>
        â€¢ ××™×©×•×¨ × ×™×›×•×™ ××¡ ×‘××§×•×¨ (×‘×ª×•×§×£)<br>
        â€¢ ××™×©×•×¨ ××‘× ×§ ×¢×œ ×¤×¨×˜×™ ×”×—×©×‘×•×Ÿ / ×©×™×§ ××‘×•×˜×œ<br>
        â€¢ ×¢×•×¡×§ ×¤×˜×•×¨ â€” ×ª×¢×•×“×ª ×¢×•×¡×§ ×¤×˜×•×¨<br>
        â€¢ ×¢×•×‘×“ ×¢×œ ×‘×¡×™×¡ ××–×•××Ÿ â€” ××›×ª×‘ ×¨×•××” ×—×©×‘×•×Ÿ
      </div>
    </div>

    <div class="nav-buttons">
      <span></span>
      <button class="btn btn-primary" onclick="nextStep(1)">×”××©×š ×œ×©×œ×‘ ×”×‘× â†</button>
    </div>
  </div>

  <!-- STEP 2: Details -->
  <div class="panel" id="panel-2">
    <div class="card">
      <div class="card-title">×¤×¨×˜×™ ×”×¢×¡×§</div>
      <div class="card-subtitle">××œ××• ××ª ×¤×¨×˜×™ ×”×¢×¡×§ / ×”×—×‘×¨×” / ×”×¢×•×¡×§</div>

      <div class="form-grid">
        <div class="field full">
          <label>×©× ×”×—×‘×¨×” / ×©×•×ª×¤×•×ª / ×¢×¡×§ <span class="req">*</span></label>
          <input type="text" id="f-business-name" placeholder="×©× ××œ× ×©×œ ×”×¢×¡×§">
          <span class="error-msg">×©×“×” ×—×•×‘×”</span>
        </div>
        <div class="field">
          <label>××¡×¤×¨ ×¢×•×¡×§ ××•×¨×©×” <span class="req">*</span></label>
          <input type="text" id="f-osek" placeholder="xxxxxxxxx">
          <span class="error-msg">×©×“×” ×—×•×‘×”</span>
        </div>
        <div class="field">
          <label>××¡' ×ª×™×§ × ×™×›×•×™×™× / ×—.×¤ / ×—"×¦ / ×ª.×– / ×¢.×¤ <span class="req">*</span></label>
          <input type="text" id="f-nikuyim" placeholder="××¡×¤×¨">
          <span class="error-msg">×©×“×” ×—×•×‘×”</span>
        </div>
        <div class="field">
          <label>×ª××¨×™×š ×ª×•×§×£ ××™×©×•×¨ × ×™×›×•×™ ××¡ ×‘××§×•×¨ <span class="req">*</span></label>
          <input type="date" id="f-nikuy-date">
          <span class="error-msg">×©×“×” ×—×•×‘×”</span>
        </div>
        <div class="field full">
          <label>××”×•×ª ×”×¢×¡×§ <span class="req">*</span></label>
          <input type="text" id="f-business-type" placeholder="×ª×™××•×¨ ×§×¦×¨ ×©×œ ×¤×¢×™×œ×•×ª ×”×¢×¡×§">
          <span class="error-msg">×©×“×” ×—×•×‘×”</span>
        </div>
      </div>

      <div class="section-divider">×›×ª×•×‘×ª ×œ××©×œ×•×— ×”×•×“×¢×•×ª ×ª×©×œ×•×</div>

      <div class="form-grid">
        <div class="field">
          <label>×¨×—×•×‘ <span class="req">*</span></label>
          <input type="text" id="f-street" placeholder="×©× ×”×¨×—×•×‘">
          <span class="error-msg">×©×“×” ×—×•×‘×”</span>
        </div>
        <div class="field">
          <label>××¡' ×‘×™×ª <span class="req">*</span></label>
          <input type="text" id="f-house" placeholder="××¡×¤×¨">
          <span class="error-msg">×©×“×” ×—×•×‘×”</span>
        </div>
        <div class="field">
          <label>×¢×™×¨ <span class="req">*</span></label>
          <input type="text" id="f-city" placeholder="×©× ×”×¢×™×¨">
          <span class="error-msg">×©×“×” ×—×•×‘×”</span>
        </div>
        <div class="field">
          <label>××™×§×•×“ <span class="req">*</span></label>
          <input type="text" id="f-zip" placeholder="7 ×¡×¤×¨×•×ª">
          <span class="error-msg">×©×“×” ×—×•×‘×”</span>
        </div>
        <div class="field">
          <label>×ª"×“</label>
          <input type="text" id="f-po-box" placeholder="××•×¤×¦×™×•× ×œ×™">
        </div>
        <div class="field">
          <label>×›×ª×•×‘×ª ××™××™×™×œ <span class="req">*</span></label>
          <input type="email" id="f-email" placeholder="example@domain.com">
          <span class="error-msg">×©×“×” ×—×•×‘×”</span>
        </div>
        <div class="field">
          <label>××¡×¤×¨ ×˜×œ×¤×•×Ÿ <span class="req">*</span></label>
          <input type="tel" id="f-phone" placeholder="0x-xxxxxxx">
          <span class="error-msg">×©×“×” ×—×•×‘×”</span>
        </div>
        <div class="field">
          <label>××¡×¤×¨ ×˜×œ×¤×•×Ÿ × ×™×™×“ <span class="req">*</span></label>
          <input type="tel" id="f-mobile" placeholder="05x-xxxxxxx">
          <span class="error-msg">×©×“×” ×—×•×‘×”</span>
        </div>
        <div class="field">
          <label>××¡×¤×¨ ×¤×§×¡</label>
          <input type="tel" id="f-fax" placeholder="××•×¤×¦×™×•× ×œ×™">
        </div>
      </div>

      <div class="section-divider">×¤×¨×˜×™ ×‘× ×§ ×œ×‘×™×¦×•×¢ ×ª×©×œ×•××™×</div>

      <div class="form-grid">
        <div class="field">
          <label>×©× ×”×‘× ×§ <span class="req">*</span></label>
          <select id="f-bank-name">
            <option value="">-- ×‘×—×¨ ×‘× ×§ --</option>
            <option>×‘× ×§ ×”×¤×•×¢×œ×™×</option>
            <option>×‘× ×§ ×œ××•××™</option>
            <option>×‘× ×§ ×“×™×¡×§×•× ×˜</option>
            <option>×‘× ×§ ××–×¨×—×™ ×˜×¤×—×•×ª</option>
            <option>×‘× ×§ ×”×‘×™× ×œ××•××™</option>
            <option>×‘× ×§ ×™×¨×•×©×œ×™×</option>
            <option>×‘× ×§ ××•×¦×¨ ×”×—×™×™×œ</option>
            <option>×‘× ×§ ××¨×›× ×ª×™×œ ×“×™×¡×§×•× ×˜</option>
            <option>×™×•×‘× ×§</option>
            <option>ONE ZERO</option>
            <option>××—×¨</option>
          </select>
          <span class="error-msg">×©×“×” ×—×•×‘×”</span>
        </div>
        <div class="field">
          <label>××¡×¤×¨ ×¡× ×™×£ <span class="req">*</span></label>
          <input type="text" id="f-bank-branch" placeholder="××¡×¤×¨ ×¡× ×™×£">
          <span class="error-msg">×©×“×” ×—×•×‘×”</span>
        </div>
        <div class="field full">
          <label>×›×ª×•×‘×ª ×”×¡× ×™×£ <span class="req">*</span></label>
          <input type="text" id="f-bank-address" placeholder="×›×ª×•×‘×ª ××œ××” ×©×œ ×”×¡× ×™×£">
          <span class="error-msg">×©×“×” ×—×•×‘×”</span>
        </div>
        <div class="field">
          <label>××™×§×•×“ ×¡× ×™×£ <span class="req">*</span></label>
          <input type="text" id="f-bank-zip" placeholder="××™×§×•×“">
          <span class="error-msg">×©×“×” ×—×•×‘×”</span>
        </div>
        <div class="field">
          <label>××¡×¤×¨ ×—×©×‘×•×Ÿ ×‘× ×§ <span class="req">*</span></label>
          <input type="text" id="f-bank-account" placeholder="××¡×¤×¨ ×—×©×‘×•×Ÿ">
          <span class="error-msg">×©×“×” ×—×•×‘×”</span>
        </div>
      </div>

      <div class="section-divider">×©××œ×•×ª × ×•×¡×¤×•×ª</div>

      <div class="form-grid">
        <div class="field full">
          <label>×”×× ×§×™×™××ª ×§×™×¨×‘×” ×œ×—×‘×¨ ××•×¢×¦×” ××• ×œ×¢×•×‘×“ ×”×¨×©×•×ª? <span class="req">*</span></label>
          <div class="radio-group">
            <label class="radio-btn" id="rel-yes-btn">
              <input type="radio" name="kinship" value="yes" onchange="handleKinship('yes')">
              <span class="radio-dot"></span> ×›×Ÿ
            </label>
            <label class="radio-btn" id="rel-no-btn">
              <input type="radio" name="kinship" value="no" onchange="handleKinship('no')">
              <span class="radio-dot"></span> ×œ×
            </label>
          </div>
        </div>
        <div class="field full" id="affidavit-field" style="display:none">
          <label>×¦×™×¨×•×£ ×ª×¦×”×™×¨ <span class="req">*</span></label>
          <div class="file-upload" id="affidavit-upload">
            <input type="file" accept=".pdf,.jpg,.jpeg,.png" onchange="handleFile('affidavit-upload', 'affidavit-name', this)">
            <div class="file-upload-icon">ğŸ“</div>
            <div class="file-upload-text"><strong>×œ×—×¥ ×œ×”×¢×œ××ª ×ª×¦×”×™×¨</strong><br>PDF / JPG / PNG</div>
            <div class="file-name" id="affidavit-name"></div>
          </div>
        </div>
        <div class="field full">
          <label>×”×× ×¢×•×‘×“ ×‘×¢×‘×•×“×•×ª ×”× ×“×¡×” ×‘× ××™×•×ª? <span class="req">*</span></label>
          <div class="radio-group">
            <label class="radio-btn" id="eng-yes-btn">
              <input type="radio" name="engineering" value="yes" onchange="selectRadio('eng-yes-btn','eng-no-btn')">
              <span class="radio-dot"></span> ×›×Ÿ
            </label>
            <label class="radio-btn" id="eng-no-btn">
              <input type="radio" name="engineering" value="no" onchange="selectRadio('eng-no-btn','eng-yes-btn')">
              <span class="radio-dot"></span> ×œ×
            </label>
          </div>
        </div>
      </div>
    </div>

    <div class="nav-buttons">
      <button class="btn btn-secondary" onclick="prevStep(2)">â† ×—×–×•×¨</button>
      <button class="btn btn-primary" onclick="nextStep(2)">×”××©×š ×œ×©×œ×‘ ×”×‘× â†</button>
    </div>
  </div>

  <!-- STEP 3: Documents -->
  <div class="panel" id="panel-3">
    <div class="card">
      <div class="card-title">×¦×™×¨×•×£ ××¡××›×™×</div>
      <div class="card-subtitle">×”×¢×œ×• ××ª ×”××¡××›×™× ×”× ×“×¨×©×™× (PDF, JPG, PNG â€” ×¢×“ 5MB ×œ×§×•×‘×¥)</div>

      <div class="form-grid">
        <div class="field full">
          <label>××™×©×•×¨ ××‘× ×§ / ×”×¢×ª×§ ×©×™×§ ××‘×•×˜×œ <span class="req">*</span></label>
          <div class="file-upload" id="bank-upload">
            <input type="file" accept=".pdf,.jpg,.jpeg,.png" onchange="handleFile('bank-upload','bank-name',this)">
            <div class="file-upload-icon">ğŸ¦</div>
            <div class="file-upload-text"><strong>×œ×—×¥ ×œ×”×¢×œ××”</strong><br>××™×©×•×¨ ××‘× ×§ ××• ×©×™×§ ××‘×•×˜×œ</div>
            <div class="file-name" id="bank-name"></div>
          </div>
        </div>

        <div class="field full">
          <label>××¡××š × ×™×”×•×œ ×¡×¤×¨×™× <span class="req">*</span></label>
          <div class="file-upload" id="books-upload">
            <input type="file" accept=".pdf,.jpg,.jpeg,.png" onchange="handleFile('books-upload','books-name',this)">
            <div class="file-upload-icon">ğŸ“š</div>
            <div class="file-upload-text"><strong>×œ×—×¥ ×œ×”×¢×œ××”</strong><br>××™×©×•×¨ × ×™×”×•×œ ×¡×¤×¨×™×</div>
            <div class="file-name" id="books-name"></div>
          </div>
        </div>

        <div class="field full">
          <label>××¡××š × ×™×›×•×™ ××¡ ×‘××§×•×¨ <span class="req">*</span></label>
          <div class="file-upload" id="tax-upload">
            <input type="file" accept=".pdf,.jpg,.jpeg,.png" onchange="handleFile('tax-upload','tax-name',this)">
            <div class="file-upload-icon">ğŸ“„</div>
            <div class="file-upload-text"><strong>×œ×—×¥ ×œ×”×¢×œ××”</strong><br>× ×™×›×•×™ ××¡ ×‘××§×•×¨ / ×ª×¢×•×“×ª ×¢×•×¡×§ ×¤×˜×•×¨</div>
            <div class="file-name" id="tax-name"></div>
          </div>
        </div>

        <div class="field full">
          <label>×”×× ×¢×•×‘×“ ×¢×œ ×‘×¡×™×¡ ××–×•××Ÿ? <span class="req">*</span></label>
          <div class="radio-group">
            <label class="radio-btn" id="cash-yes-btn">
              <input type="radio" name="cashbasis" value="yes" onchange="handleCashBasis('yes')">
              <span class="radio-dot"></span> ×›×Ÿ
            </label>
            <label class="radio-btn" id="cash-no-btn">
              <input type="radio" name="cashbasis" value="no" onchange="handleCashBasis('no')">
              <span class="radio-dot"></span> ×œ×
            </label>
          </div>
        </div>

        <div class="field full" id="cash-doc-field" style="display:none">
          <label>××›×ª×‘ ×¨×•××” ×—×©×‘×•×Ÿ â€” ×¢×‘×•×“×” ×¢×œ ×‘×¡×™×¡ ××–×•××Ÿ <span class="req">*</span></label>
          <div class="file-upload" id="cash-upload">
            <input type="file" accept=".pdf,.jpg,.jpeg,.png" onchange="handleFile('cash-upload','cash-name',this)">
            <div class="file-upload-icon">ğŸ’µ</div>
            <div class="file-upload-text"><strong>×œ×—×¥ ×œ×”×¢×œ××”</strong><br>××›×ª×‘ ××¨×•"×—</div>
            <div class="file-name" id="cash-name"></div>
          </div>
        </div>

        <div class="field full">
          <label>×¦×™×œ×•×/×”×¢×ª×§ ×—×©×‘×•× ×™×ª <span class="req">*</span></label>
          <div class="file-upload" id="invoice-upload">
            <input type="file" accept=".pdf,.jpg,.jpeg,.png" onchange="handleFile('invoice-upload','invoice-name',this)">
            <div class="file-upload-icon">ğŸ§¾</div>
            <div class="file-upload-text"><strong>×œ×—×¥ ×œ×”×¢×œ××”</strong><br>×¦×™×œ×•× ×—×©×‘×•× ×™×ª ×œ×“×•×’××”</div>
            <div class="file-name" id="invoice-name"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="nav-buttons">
      <button class="btn btn-secondary" onclick="prevStep(3)">â† ×—×–×•×¨</button>
      <button class="btn btn-primary" onclick="nextStep(3)">×”××©×š ×œ×©×œ×‘ ×”×‘× â†</button>
    </div>
  </div>

  <!-- STEP 4: Sign & Submit -->
  <div class="panel" id="panel-4">
    <div class="card">
      <div class="card-title">×ª×—×•× ×¢×™×¡×•×§ ×•××™×©×•×¨</div>
      <div class="card-subtitle">×‘×—×¨×• ×ª×—×•× ×¢×™×¡×•×§ ×•×—×ª××• ×¢×œ ×”×˜×•×¤×¡</div>

      <div class="form-grid">
        <div class="field">
          <label>×ª×—×•× ×¢×™×¡×•×§ ×¨××©×™ <span class="req">*</span></label>
          <select id="f-main-domain">
            <option value="">-- ×‘×—×¨ --</option>
            <option>×¨×›×© ×˜×•×‘×™×Ÿ</option>
            <option>×™×•×¢×¥</option>
            <option>×§×‘×œ×Ÿ</option>
            <option>×©×™×¨×•×ª ×›×œ×œ×™</option>
            <option>×¢×•×¨×š ×“×™×Ÿ</option>
          </select>
          <span class="error-msg">×©×“×” ×—×•×‘×”</span>
        </div>
        <div class="field">
          <label>×ª×—×•× ×¢×™×¡×•×§ ××©× ×™ (×ª×™××•×¨ ×§×¦×¨) <span class="req">*</span></label>
          <input type="text" id="f-sub-domain" placeholder="×œ×“×•×’××”: × ×™×§×™×•×Ÿ, ××—×–×§×”, ×™×™×¢×•×¥...">
          <span class="error-msg">×©×“×” ×—×•×‘×”</span>
        </div>
        <div class="field">
          <label>×ª××¨×™×š <span class="req">*</span></label>
          <input type="date" id="f-sign-date">
          <span class="error-msg">×©×“×” ×—×•×‘×”</span>
        </div>
      </div>

      <div class="section-divider">×”×¡×›××” ×•×¤×¨×˜×™×•×ª</div>

      <div class="agree-wrap" style="margin-bottom:24px">
        <input type="checkbox" id="f-agree">
        <label for="f-agree">
          ×”××™×“×¢ ×©× ××¡×¨ ×¢×œ-×™×“×™ × ××¡×¨ ×‘×”×¡×›××ª×™ ×•×‘×¨×¦×•× ×™ ×”××œ××™× ×•×™×“×•×¢ ×œ×™ ×©×™×©××¨ ×‘×××’×¨×™ ×”××™×“×¢ ×©×œ ×”×¢×™×¨×™×™×” ××• ×’×•×¨× ××—×¨ ××˜×¢××”. ×™×“×•×¢ ×œ×™ ×›×™ ×”××™×“×¢ ×™×©××© ×œ×¦×•×¨×š × ×™×”×•×œ, ×ª×¤×¢×•×œ ×•×˜×™×¤×•×œ ×‘×›×œ ×”×§×©×•×¨ ×œ×”×¡×›××™ ×™×•×¢×¦×™×/×¡×¤×§×™× ×©×œ ×”×¢×™×¨×™×™×”. ×™×“×•×¢ ×œ×™ ×›×™ ×‘××¤×©×¨×•×ª×™ ×œ×‘×§×©, ×œ×§×‘×œ ×•×œ×ª×§×Ÿ ××ª ×”××™×“×¢ ××•×“×•×ª×™×™. (×œ×¤×™ ×¡×¢×™×£ 11 ×œ×—×•×§)
        </label>
      </div>

      <div class="section-divider">×—×ª×™××”</div>

      <div class="signature-wrap">
        <div class="signature-toolbar">
          <span>×—×ª××• ×›××Ÿ ×‘×××¦×¢×•×ª ×”×¢×›×‘×¨ / ××¦×‘×¢</span>
          <button class="clear-btn" onclick="clearSignature()">× ×§×” ×—×ª×™××”</button>
        </div>
        <canvas id="sigCanvas" width="820" height="160"></canvas>
      </div>
    </div>

    <div class="nav-buttons">
      <button class="btn btn-secondary" onclick="prevStep(4)">â† ×—×–×•×¨</button>
      <button class="btn btn-success" onclick="submitForm()">âœ… ×©×œ×— ×˜×•×¤×¡</button>
    </div>
  </div>

  <!-- SUCCESS -->
  <div class="panel" id="panel-success">
    <div class="card success-screen">
      <div class="success-icon">âœ“</div>
      <h2>×”×˜×•×¤×¡ × ×©×œ×— ×‘×”×¦×œ×—×”!</h2>
      <p>×‘×§×©×ª ×¤×ª×™×—×ª ×”×¡×¤×§ ×”×ª×§×‘×œ×” ×•×ª×˜×•×¤×œ ×¢×œ ×™×“×™ ××—×œ×§×ª ×”×’×–×‘×¨×•×ª.</p>
      <div class="ref-number" id="ref-number">××¡×¤×¨ ×¤× ×™×™×”: ×˜×•×¢×Ÿ...</div>
      <p style="margin-top:8px">×ª×§×‘×œ×• ×¢×“×›×•×Ÿ ×œ×›×ª×•×‘×ª ×”××™××™×™×œ ×©×”×–× ×ª× ×‘×˜×•×¤×¡.</p>
    </div>
  </div>

</div><!-- /content -->

<!-- Loading -->
<div class="loading-overlay" id="loading">
  <div class="spinner"></div>
</div>

<!-- EmailJS -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script>
  emailjs.init('scrflcwfZTNl72nYy');
</script>

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getFirestore, collection, addDoc, serverTimestamp }
    from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";


  // ==========================================
  // ğŸ”§ ×”×›× ×¡ ×›××Ÿ ××ª ×¤×¨×˜×™ Firebase ×©×œ×š
  // ==========================================
  const firebaseConfig = {
    apiKey: "AIzaSyCxpDvpncsBEhAJr1WQilgfZehIxwGSrps",
    authDomain: "supplier-opening-form.firebaseapp.com",
    projectId: "supplier-opening-form",
    storageBucket: "supplier-opening-form.firebasestorage.app",
    messagingSenderId: "3049513944",
    appId: "1:3049513944:web:07edd5c9756ec95d0e48ad",
    measurementId: "G-2N31VNWR1T"
  };
  // ==========================================

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  function getFileInput(uploadId) {
    return document.querySelector(`#${uploadId} input[type="file"]`);
  }

  async function uploadFile(fieldId) {
    const input = getFileInput(fieldId);
    if (!input || !input.files[0]) return null;
    const file = input.files[0];
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = () => resolve({ name: file.name, type: file.type, data: reader.result });
      reader.onerror = reject;
      reader.readAsDataURL(file);
    });
  }

  window._submitToFirebase = async function() {
    showLoading(true);
    try {
      // Upload files
      const fileUrls = {};
      fileUrls.bankDoc      = await uploadFile('bank-upload');
      fileUrls.booksDoc     = await uploadFile('books-upload');
      fileUrls.taxDoc       = await uploadFile('tax-upload');
      fileUrls.invoiceDoc   = await uploadFile('invoice-upload');
      fileUrls.affidavitDoc = await uploadFile('affidavit-upload');
      fileUrls.cashDoc      = await uploadFile('cash-upload');

      // Signature
      const canvas = document.getElementById('sigCanvas');
      const signatureData = canvas.toDataURL('image/png');

      // Gather data
      const data = {
        businessName:  v('f-business-name'),
        osekMorsheh:   v('f-osek'),
        nikuyim:       v('f-nikuyim'),
        nikuyDate:     v('f-nikuy-date'),
        businessType:  v('f-business-type'),
        address: {
          street: v('f-street'), house: v('f-house'),
          city: v('f-city'), zip: v('f-zip'), poBox: v('f-po-box')
        },
        contact: {
          email: v('f-email'), phone: v('f-phone'),
          mobile: v('f-mobile'), fax: v('f-fax')
        },
        bank: {
          name: v('f-bank-name'), branch: v('f-bank-branch'),
          address: v('f-bank-address'), zip: v('f-bank-zip'),
          account: v('f-bank-account')
        },
        kinship:     document.querySelector('input[name="kinship"]:checked')?.value || '',
        engineering: document.querySelector('input[name="engineering"]:checked')?.value || '',
        cashBasis:   document.querySelector('input[name="cashbasis"]:checked')?.value || '',
        mainDomain:  v('f-main-domain'),
        subDomain:   v('f-sub-domain'),
        signDate:    v('f-sign-date'),
        signature:   signatureData,
        files:       fileUrls,
        submittedAt: serverTimestamp(),
        status: 'pending'
      };

      const docRef = await addDoc(collection(db, 'vendors'), data);

      // ×©×œ×™×—×ª ××™×™×œ ×¢× EmailJS
      try {
        await emailjs.send('service_acob49b', 'template_d8vvd3g', {
          business_name: data.businessName,
          osek:          data.osekMorsheh,
          nikuyim:       data.nikuyim,
          business_type: data.businessType,
          main_domain:   data.mainDomain,
          sub_domain:    data.subDomain,
          street:        data.address.street,
          house:         data.address.house,
          city:          data.address.city,
          zip:           data.address.zip,
          email:         data.contact.email,
          phone:         data.contact.phone,
          mobile:        data.contact.mobile,
          bank_name:     data.bank.name,
          bank_branch:   data.bank.branch,
          bank_account:  data.bank.account,
          file_bank:     fileUrls.bankDoc?.name    || '×œ× ×”×•×¢×œ×”',
          file_books:    fileUrls.booksDoc?.name   || '×œ× ×”×•×¢×œ×”',
          file_tax:      fileUrls.taxDoc?.name     || '×œ× ×”×•×¢×œ×”',
          file_invoice:  fileUrls.invoiceDoc?.name || '×œ× ×”×•×¢×œ×”',
          sign_date:     data.signDate,
          name:          data.businessName,
        });
      } catch(emailErr) {
        console.warn('Email sending failed:', emailErr);
      }

      showLoading(false);
      document.getElementById('ref-number').textContent = '××¡×¤×¨ ×¤× ×™×™×”: ' + docRef.id.substring(0,8).toUpperCase();
      goToStep('success');

    } catch(err) {
      showLoading(false);
      alert('××™×¨×¢×” ×©×’×™××” ×‘×©×œ×™×—×ª ×”×˜×•×¤×¡: ' + err.message);
      console.error(err);
    }
  };

  function v(id) {
    return document.getElementById(id)?.value?.trim() || '';
  }

  function showLoading(show) {
    document.getElementById('loading').classList.toggle('active', show);
  }
</script>

<script>
  // Step management
  let currentStep = 1;
  const totalSteps = 4;

  function updateTabs(step) {
    for(let i = 1; i <= totalSteps; i++) {
      const tab = document.getElementById('step-tab-' + i);
      tab.classList.remove('active','done');
      if(i < step) tab.classList.add('done');
      else if(i === step) tab.classList.add('active');
    }
  }

  function showPanel(step) {
    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
    const target = step === 'success' ? 'panel-success' : 'panel-' + step;
    document.getElementById(target).classList.add('active');
    window.scrollTo({top: 0, behavior:'smooth'});
  }

  function goToStep(step) {
    if(typeof step === 'number' && step > currentStep) return; // can't skip forward
    if(step === 'success') {
      updateTabs(5);
      showPanel('success');
      return;
    }
    currentStep = step;
    updateTabs(step);
    showPanel(step);
  }

  function nextStep(from) {
    if(!validateStep(from)) return;
    currentStep = from + 1;
    updateTabs(currentStep);
    showPanel(currentStep);
  }

  function prevStep(from) {
    currentStep = from - 1;
    updateTabs(currentStep);
    showPanel(currentStep);
  }

  // Validation
  function validateStep(step) {
    let ok = true;

    if(step === 2) {
      const required2 = ['f-business-name','f-osek','f-nikuyim','f-nikuy-date',
        'f-business-type','f-street','f-house','f-city','f-zip','f-email',
        'f-phone','f-mobile','f-bank-name','f-bank-branch','f-bank-address',
        'f-bank-zip','f-bank-account'];
      required2.forEach(id => { if(!checkField(id)) ok = false; });
      if(!document.querySelector('input[name="kinship"]:checked')) {
        ok = false;
        alert('×™×© ×œ×‘×—×•×¨ ×”×× ×§×™×™××ª ×§×™×¨×‘×” ×œ×—×‘×¨ ××•×¢×¦×”');
      }
      if(!document.querySelector('input[name="engineering"]:checked')) {
        ok = false;
        alert('×™×© ×œ×‘×—×•×¨ ×”×× ×¢×•×‘×“ ×‘×¢×‘×•×“×•×ª ×”× ×“×¡×” ×‘× ××™×•×ª');
      }
    }

    if(step === 3) {
      const bankFile = document.querySelector('#bank-upload input[type="file"]');
      const booksFile = document.querySelector('#books-upload input[type="file"]');
      const taxFile = document.querySelector('#tax-upload input[type="file"]');
      const invoiceFile = document.querySelector('#invoice-upload input[type="file"]');

      if(!bankFile?.files[0])   { ok = false; alert('×™×© ×œ×¦×¨×£ ××™×©×•×¨ ××‘× ×§ / ×©×™×§ ××‘×•×˜×œ'); }
      if(!booksFile?.files[0])  { ok = false; alert('×™×© ×œ×¦×¨×£ ××¡××š × ×™×”×•×œ ×¡×¤×¨×™×'); }
      if(!taxFile?.files[0])    { ok = false; alert('×™×© ×œ×¦×¨×£ ××¡××š × ×™×›×•×™ ××¡ ×‘××§×•×¨'); }
      if(!invoiceFile?.files[0]){ ok = false; alert('×™×© ×œ×¦×¨×£ ×¦×™×œ×•× ×—×©×‘×•× ×™×ª'); }

      if(!document.querySelector('input[name="cashbasis"]:checked')) {
        ok = false;
        alert('×™×© ×œ×‘×—×•×¨ ×”×× ×¢×•×‘×“ ×¢×œ ×‘×¡×™×¡ ××–×•××Ÿ');
      }
    }

    if(step === 4) {
      const required4 = ['f-main-domain','f-sub-domain','f-sign-date'];
      required4.forEach(id => { if(!checkField(id)) ok = false; });
      if(!document.getElementById('f-agree').checked) {
        ok = false;
        alert('×™×© ×œ××©×¨ ××ª ×ª× ××™ ×”×¤×¨×˜×™×•×ª');
      }
      if(!hasSignature()) {
        ok = false;
        alert('×™×© ×œ×—×ª×•× ×¢×œ ×”×˜×•×¤×¡');
      }
    }

    return ok;
  }

  function checkField(id) {
    const el = document.getElementById(id);
    const field = el.closest('.field');
    if(!el.value.trim()) {
      field.classList.add('has-error');
      return false;
    } else {
      field.classList.remove('has-error');
      return true;
    }
  }

  // Add live validation removal
  document.addEventListener('input', function(e) {
    if(e.target.closest('.field')?.classList.contains('has-error')) {
      e.target.closest('.field').classList.remove('has-error');
    }
  });

  // Radio buttons
  function selectRadio(activeId, otherId) {
    document.getElementById(activeId).classList.add('selected');
    document.getElementById(otherId).classList.remove('selected');
  }

  function handleKinship(val) {
    selectRadio('rel-' + val + '-btn', 'rel-' + (val==='yes'?'no':'yes') + '-btn');
    document.getElementById('affidavit-field').style.display = val === 'yes' ? 'block' : 'none';
  }

  function handleCashBasis(val) {
    selectRadio('cash-' + val + '-btn', 'cash-' + (val==='yes'?'no':'yes') + '-btn');
    document.getElementById('cash-doc-field').style.display = val === 'yes' ? 'block' : 'none';
  }

  // File upload
  function handleFile(uploadId, nameId, input) {
    const file = input.files[0];
    const wrap = document.getElementById(uploadId);
    const nameEl = document.getElementById(nameId);
    if(file) {
      wrap.classList.add('has-file');
      nameEl.textContent = 'âœ“ ' + file.name;
    }
  }

  // Signature canvas
  const canvas = document.getElementById('sigCanvas');
  const ctx = canvas.getContext('2d');
  let drawing = false;
  let hasSig = false;

  function getPos(e) {
    const rect = canvas.getBoundingClientRect();
    const scaleX = canvas.width / rect.width;
    const scaleY = canvas.height / rect.height;
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
    return {
      x: (clientX - rect.left) * scaleX,
      y: (clientY - rect.top) * scaleY
    };
  }

  canvas.addEventListener('mousedown', (e) => { drawing = true; const p = getPos(e); ctx.beginPath(); ctx.moveTo(p.x, p.y); });
  canvas.addEventListener('mousemove', (e) => {
    if(!drawing) return;
    const p = getPos(e);
    ctx.lineTo(p.x, p.y);
    ctx.strokeStyle = '#1a4f8a';
    ctx.lineWidth = 2.5;
    ctx.lineCap = 'round';
    ctx.stroke();
    hasSig = true;
  });
  canvas.addEventListener('mouseup', () => drawing = false);
  canvas.addEventListener('mouseleave', () => drawing = false);
  canvas.addEventListener('touchstart', (e) => { e.preventDefault(); drawing = true; const p = getPos(e); ctx.beginPath(); ctx.moveTo(p.x, p.y); });
  canvas.addEventListener('touchmove', (e) => {
    e.preventDefault();
    if(!drawing) return;
    const p = getPos(e);
    ctx.lineTo(p.x, p.y);
    ctx.strokeStyle = '#1a4f8a';
    ctx.lineWidth = 2.5;
    ctx.lineCap = 'round';
    ctx.stroke();
    hasSig = true;
  });
  canvas.addEventListener('touchend', () => drawing = false);

  function clearSignature() { ctx.clearRect(0, 0, canvas.width, canvas.height); hasSig = false; }
  function hasSignature() { return hasSig; }

  // Submit
  function submitForm() {
    if(!validateStep(4)) return;
    window._submitToFirebase();
  }

  // Set today's date
  document.getElementById('f-sign-date').value = new Date().toISOString().split('T')[0];
</script>

</body>
</html>
